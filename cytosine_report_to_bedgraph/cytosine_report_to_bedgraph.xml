<tool id="cytosine_report_to_bedgraph" name="Cytosine Report To Bedgraphs" version="0.0.0">

  <description>Converts genome-wide cytosine methylation report to Bedgraphs</description>

  <requirements>
  	<requirement type="package" version="2.3.32">igvtools</requirement>
  </requirements>

  <command interpreter="python">
<![CDATA[
        cytosine_report_to_bedgraph_wrapper.py

        --tool_dir "$__tool_directory__"

        --cytosine_report "$cytosine_report"

        --coverage_bedgraph "$coverage_bedgraph"
        #if $tdf['tdf_selector']:
          --tdf
          --igv_genome "${tdf.built_in_igv_genomes_chr_sizes.fields.path}"
          --coverage_tdf "$coverage_tdf"
        #end if

        #if $context:
          --context
          --CpG_bedgraph "$CpG_bedgraph"
          --CHG_bedgraph "$CHG_bedgraph"
          --CHH_bedgraph "$CHH_bedgraph"
          #if $tdf['tdf_selector']:
            --CpG_tdf "$CpG_tdf"
            --CHG_tdf "$CHG_tdf"
            --CHH_tdf "$CHH_tdf"
          #end if
        #else
          --CXX "$CXX_bedgraph"
          #if $tdf['tdf_selector']:
            --CXX "$CXX_tdf"
          #end if
        #end if  

        --log "$log_report"
]]>
  </command>
  <inputs>
    <param name="cytosine_report" type="data" format="txt" label="Submit a genome-wide cytosine methylation report" optional="False" />
    <param name="context" type="boolean" truevalue="true" falsevalue="false" checked="true" label="Create a bedGraph for each cytosine methylation context?" />
    <conditional name="tdf">
      <param name="tdf_selector" type="boolean" truevalue="true" falsevalue="false" checked="false" label="Generate a tdf file from each resulting bedGraph?" />
      <when value="true">
        <param name="built_in_igv_genomes_chr_sizes" type="select" label="Select Reference Genome (igv genomes chr.sizes)" help="If your genome of interest is not listed, contact your Galaxy admin">
          <options from_data_table="igv_genomes_chr_sizes">
            <filter type="sort_by" column="name"/>
            <validator type="no_options" message="No indexes are available for the selected input dataset"/>
          </options>
        </param>
      </when>
      <when value="false"></when>
    </conditional>
  </inputs>

  <outputs>
    <data name="log_report" format="txt" label="${tool.name} on ${on_string}: Log Report" />
    <data name="CpG_bedgraph" format="bedgraph" label="${tool.name} on ${on_string}: CpG context">
      <filter>context is True</filter>
    </data>
    <data name="CHG_bedgraph" format="bedgraph" label="${tool.name} on ${on_string}: CHG context">
      <filter>context is True</filter>
    </data>
    <data name="CHH_bedgraph" format="bedgraph" label="${tool.name} on ${on_string}: CHH context">
      <filter>context is True</filter>
    </data>
    <data name="CXX_bedgraph" format="bedgraph" label="${tool.name} on ${on_string}: CXX">
      <filter>context is False</filter>
    </data>
    <data name="coverage_bedgraph" format="bedgraph" label="${tool.name} on ${on_string}: Coverage" />
    <data name="CpG_tdf" format="tdf" label="${tool.name} on ${on_string}: CpG context (tdf)">
      <filter>tdf['tdf_selector'] is True and context is True</filter>
    </data>
    <data name="CHG_tdf" format="tdf" label="${tool.name} on ${on_string}: CHG context (tdf)">
          <filter>tdf['tdf_selector'] is True and context is True</filter>
    </data>
    <data name="CHH_tdf" format="tdf" label="${tool.name} on ${on_string}: CHH context (tdf)">
          <filter>tdf['tdf_selector'] is True and context is True</filter>
    </data>
    <data name="CXX_tdf" format="tdf" label="${tool.name} on ${on_string}: CXX (tdf)">
          <filter>context is False and tdf['tdf_selector'] is True</filter>
    </data>
    <data name="coverage_tdf" format="tdf" label="${tool.name} on ${on_string}: Coverage (tdf)" >
      <filter>tdf['tdf_selector'] is True</filter>
    </data>
  </outputs>

  <tests></tests>

  <help>
<![CDATA[

**What it does**

  | This tool takes as input a genome-wide cytosine methylation report (generated by the tool *Bismark Meth. Extractor*) and converts it into a bedGraph for each cytosine context (CpG, CHG and CHH). 
  | These bedGraphs display, for any given context, the ratio of methylation of each covered cytosine in the genome.
  |
  | It also produces a bedGraph displaying the coverage count of each cytosine in the genome (non-covered cytosine are ignored).
  | 

  .. class:: infomark

  | The tool outputs offer the possibility to vizualise the methylation signal of covered cytosines thanks to softwares like IGV (*Integrative Genomics Viewer*).
  | In this respect, the tool can optionally generate a tdf binary file (*Tiled Data Format*) from each converted bedGraph ; tdf format is indeed better handled by IGV than bedGraph.
]]>
  </help>
</tool>
